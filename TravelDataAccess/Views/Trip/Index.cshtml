@model IEnumerable<TravelDataAccess.Trip>

@{
    ViewData["Title"] = "Available Trips";
    var isLoggedIn = Context.Session.GetInt32("CustomerId") != null;
}

<h1><i class="bi bi-globe"></i> Available Trips</h1>

<p>
    <a asp-action="Create" class="btn btn-primary">
        <i class="bi bi-plus-circle"></i> Create New Trip
    </a>
</p>

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">
        @TempData["Error"]
    </div>
}

@if (TempData["Success"] != null)
{
    <div class="alert alert-success">
        @TempData["Success"]
    </div>
}

<div class="row">
    @foreach (var item in Model)
    {
        <div class="col-md-6 col-lg-4 mb-4">
            <div class="card h-100 shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="bi bi-geo-alt"></i> @item.Destination</h5>
                </div>
                <div class="card-body">
                    <p class="card-text">
                        <strong><i class="bi bi-tag"></i> Code:</strong> @item.Code<br/>
                        <strong><i class="bi bi-cash"></i> Price:</strong> <span class="text-success fs-5">@item.Price.ToString("C")</span><br/>
                        <strong><i class="bi bi-flag"></i> Status:</strong> 
                        <span class="badge @(item.Status == "Available" ? "bg-success" : item.Status == "Full" ? "bg-warning" : "bg-danger")">
                            @item.Status
                        </span>
                    </p>
                </div>
                <div class="card-footer bg-transparent">
                    <div class="btn-group w-100" role="group">
                        <a asp-action="Details" asp-route-id="@item.TripId" class="btn btn-sm btn-info">
                            <i class="bi bi-eye"></i> Details
                        </a>
                        @if (item.Status == "Available")
                        {
                            if (isLoggedIn)
                            {
                                <a asp-controller="Booking" asp-action="Create" asp-route-tripId="@item.TripId" class="btn btn-sm btn-success">
                                    <i class="bi bi-check-circle"></i> Book Now
                                </a>
                            }
                            else
                            {
                                <a asp-controller="Customer" asp-action="Login" class="btn btn-sm btn-success">
                                    <i class="bi bi-box-arrow-in-right"></i> Login to Book
                                </a>
                            }
                        }
                        <a asp-action="Edit" asp-route-id="@item.TripId" class="btn btn-sm btn-warning">
                            <i class="bi bi-pencil"></i> Edit
                        </a>
                        <a asp-action="Delete" asp-route-id="@item.TripId" class="btn btn-sm btn-danger">
                            <i class="bi bi-trash"></i> Delete
                        </a>
                    </div>
                </div>
            </div>
        </div>
    }
</div>

